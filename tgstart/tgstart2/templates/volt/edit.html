{% extends 'baselk.html' %}
{% load static %}

{% block title %}–ú–æ–∏ –±–æ—Ç—ã{% endblock %}

{% block head%}
    <style media="screen">
        td a{
          cursor:pointer;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
{%endblock%}


{%block mainContent%}

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">{{cBot.bot_name}} / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
      </div>


      <!-- Modal -->
      <form class="form-inline" id='addCommandForm' action="" method="post">
        {% csrf_token %}
        <div class="form-group mb-2">
          <label class="errorLine sr-only"></label><br>
            <label for="" class="sr-only">–ë–æ—Ç —Ç–æ–∫–µ–Ω:</label>
            <textarea rows="4" cols="80" required class="tgToketnInput form-control" autocomplete="off" placeholder="–ö–æ–º–∞–Ω–¥–∞" type="text" name="botCommand" id="tgToken" value=""></textarea><br>
            <textarea rows="4" cols="80" required class="tgToketnInput form-control" autocomplete="off" placeholder="–û—Ç–≤–µ—Ç" type="text" name="botResponse" id="tgToken" value=""></textarea>
        </div>

      <input type="submit" value="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É" class="createBot btn btn-primary"></input>
      </form><br>


      {%if cBotCustomCommands != 0%}
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>–ö–æ–º–∞–Ω–¥–∞</th>
              <th>–û—Ç–≤–µ—Ç</th>
              <th>–£–¥–∞–ª–∏—Ç—å</th>
              <!-- <th>–û—Ç–≤–µ—Ç</th> -->
            </tr>
          </thead>
          <tbody>
            {%for i in cBotCustomCommands%}
              <tr>
                <td>{{i.command}}</td>
                <td>{{i.response}}</td>
                <td><a class="editLink"  data-id='{{cBot.id}}' data-idCommand='{{i.id}}'">–£–¥–∞–ª–∏—Ç—å</a></td>
              </tr>
            {%endfor%}
          </tbody>
        </table>
      {%else%}
        <h2>–ö–æ–º–∞–Ω–¥ –µ—â—ë –Ω–µ—Çüò≠</h2>
      {%endif%}
{% csrf_token %}

    </main>
    <script>
      $('.editLink').click(function(){
        // let a = $(this).data('bid')
        let data = 'csrfmiddlewaretoken='+$("input[name='csrfmiddlewaretoken']").val()+'&botID='+$(this).data('id')+"&idCommand="+$(this).data('idcommand')
        // console.log(data)
        $.ajax({
          url: '', // –ø—É—Ç—å –∫ php-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
          type: 'POST', // –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
          dataType: 'html', // —Ç–∏–ø –æ–∂–∏–¥–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ
          data: data, // –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
          error: function(req, text, error){ // –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ajax-–∑–∞–ø—Ä–æ—Å–∞
            alert('–•—å—é—Å—Ç–æ–Ω, –£ –Ω–∞—Å –ø—Ä–æ–±–ª–µ–º—ã! ' + text + ' | ' + error);
          }
        });
        $(this).parents('tr').remove()
      });
      // if ( window.history.replaceState ) {
      //        window.history.replaceState( null, null, window.location.href );
      //    }
      // $('.createBot').click(function(){
      //   // let a = $(this).data('bid')
      //   // let data = 'csrfmiddlewaretoken='+$("input[name='csrfmiddlewaretoken']").val()+'&botID='+$(this).data('id')+"&idCommand="+$(this).data('idcommand')
      //   // console.log(data)
      //   $.ajax({
      //     url: '', // –ø—É—Ç—å –∫ php-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É
      //     type: 'POST', // –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
      //     dataType: 'html', // —Ç–∏–ø –æ–∂–∏–¥–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ
      //     data: $('#addCommandForm').serialize(), // –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–¥–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      //     error: function(req, text, error){ // –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ajax-–∑–∞–ø—Ä–æ—Å–∞
      //       alert('–•—å—é—Å—Ç–æ–Ω, –£ –Ω–∞—Å –ø—Ä–æ–±–ª–µ–º—ã! ' + text + ' | ' + error);
      //     }
      //   });
      // });
    </script>
{%endblock%}
