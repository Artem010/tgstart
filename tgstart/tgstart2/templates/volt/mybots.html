{% extends 'baselk.html' %}
{% load static %}

{% block title %}Мои боты{% endblock %}


{% block head%}
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">
    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <meta name="theme-color" content="#7952b3">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="{% static 'css/dashboard.css' %}" rel="stylesheet">
{%endblock%}


{%block mainContent%}

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Мои боты</h1>
        <div class="btn-toolbar mb-2 mb-md-0">

          <!-- Button trigger modal -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Создать Бота
          </button>
        </div>
      </div>


      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="alert alert-light" role="alert">
                Для начала необходимо создать бота в <a href="https://t.me/botfather">BotFather</a>,
                скопировать полученный токен и вставить в поле ниже. Инструкция: Как создать бота в BotFather
              </div>
              <form class="form-inline" action="" method="post">
                {% csrf_token %}
                <div class="form-group mb-2">
                  <label class="errorLine sr-only"></label><br>
                    <label for="" class="sr-only">Бот токен:</label>
                    <input class="tgToketnInput form-control" autocomplete="off" type="text" name="tgToken" id="tgToken" value="">
                </div>
                <div class="form-check">
                <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
                <label class="form-check-label" for="exampleRadios1">
                  Эхо-бот
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2">
                <label class="form-check-label" for="exampleRadios2">
                  Командир
                </label>
              </div>
              <div class="form-check disabled">
                <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="option3">
                <label class="form-check-label" for="exampleRadios3">
                  Онлайн магазин
                </label>
              </div>
              <input type="submit" disabled value="Создать бота" class="createBot btn btn-primary"></input>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="row">
        {%for i in bots %}
            <div class="card" style="width: 22rem;">
              <!-- <img src="..." class="card-img-top" alt="..."> -->
              <div class="text-center card-body">
                <h5 class="card-title">{{i.bot_name}}</h5>
                <!-- <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p> -->
              </div>
              <ul class="list-group list-group-flush">
                  {%if i.status == 1%}
                    <li class="text-success list-group-item">Статус: Активно</li>
                  {%else%}
                    <li class="text-danger list-group-item">Статус: Неактивно</li>
                  {% endif %}
                <li class="list-group-item">Dapibus ac facilisis in</li>
                <li class="list-group-item">Vestibulum at eros</li>
              </ul>
              <div class="card-body">
                <a  >Редактировать</a>
                {%if i.status == 1%}
                  <a href="/mybots/deactivatebot?id={{i.id}}"  class=" card-link">Отключить</a>
                {%else%}
                  <a href="/mybots/activatebot?id={{i.id}}"  class=" card-link">Включить</a>
                {%endif%}
                <a href="/mybots/removebot?id={{i.id}}"  class="text-danger card-link">Удалить бота</a>
                <!-- <a href="#" class="text-danger card-link">E</a> -->
              </div>
            </div>
        {%endfor%}
        </div>
      </div>
      <script>
        $('.tgToketnInput').on('input', function(){
        let val = $(this).val();
        if(val.includes(':')) {
          $('.createBot').removeAttr('disabled');
          $('.errorLine').text('').css('color', 'red');
        } else {
          $('.errorLine').text('Невалидный бот-токен').css('color', 'red');
          $('.createBot').attr('disabled', true);
        }
      });
      </script>

    </main>
{%endblock%}
